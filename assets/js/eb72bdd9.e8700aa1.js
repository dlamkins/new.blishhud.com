"use strict";(self.webpackChunknew_blishhud_com=self.webpackChunknew_blishhud_com||[]).push([[8694],{3905:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>m});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),u=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},h=function(e){var t=u(e.components);return i.createElement(l.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,h=o(e,["components","mdxType","originalType","parentName"]),d=u(n),p=a,m=d["".concat(l,".").concat(p)]||d[p]||c[p]||r;return n?i.createElement(m,s(s({ref:t},h),{},{components:n})):i.createElement(m,s({ref:t},h))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=p;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[d]="string"==typeof e?e:a,s[1]=o;for(var u=2;u<r;u++)s[u]=n[u];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},1291:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var i=n(7462),a=(n(7294),n(3905));const r={id:"gw2api",title:"GW2 Web API"},s=void 0,o={unversionedId:"modules/guides/gw2api",id:"modules/guides/gw2api",title:"GW2 Web API",description:"Overview",source:"@site/docs/modules/guides/gw2api.md",sourceDirName:"modules/guides",slug:"/modules/guides/gw2api",permalink:"/docs/modules/guides/gw2api",draft:!1,tags:[],version:"current",frontMatter:{id:"gw2api",title:"GW2 Web API"},sidebar:"DevGuides",previous:{title:"Settings",permalink:"/docs/modules/guides/settings"},next:{title:"Exclusive GraphicsDevice Usage",permalink:"/docs/modules/guides/graphicsdevice"}},l={},u=[{value:"Overview",id:"overview",level:2},{value:"Token Delegation",id:"token-delegation",level:2},{value:"Caching",id:"caching",level:2},{value:"Rate Limits",id:"rate-limits",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Making Requests",id:"making-requests",level:2},{value:"Checking for Permissions",id:"checking-for-permissions",level:2},{value:"Check with <code>HasPermissions</code>",id:"check-with-haspermissions",level:3},{value:"Check again with <code>SubtokenUpdated</code>",id:"check-again-with-subtokenupdated",level:3}],h={toc:u},d="wrapper";function c(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,i.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"Blish HUD offers a fully comprehensive solution to making requests to the ",(0,a.kt)("a",{parentName:"p",href:"https://wiki.guildwars2.com/wiki/API:Main"},"Guild Wars 2 API")," via our ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Archomeda/Gw2Sharp"},"Gw2Sharp")," dependency - the best in class .NET API library for Guild Wars 2."),(0,a.kt)("p",null,"Blish HUD provides access to the API client that Gw2Sharp generates through a ",(0,a.kt)("inlineCode",{parentName:"p"},"ManagedConnection")," to enable you to make authenticated API calls without the need of managing or requesting user API tokens directly."),(0,a.kt)("h2",{id:"token-delegation"},"Token Delegation"),(0,a.kt)("p",null,"Modules that wish to make authenticated requests to the API must list the permissions that are needed within their ",(0,a.kt)("a",{parentName:"p",href:"/docs/modules/overview/update-your-manifest#api-permissions"},"module manifest"),"."),(0,a.kt)("p",null,"When a module is enabled, a ",(0,a.kt)("a",{parentName:"p",href:"https://wiki.guildwars2.com/wiki/API:2/createsubtoken"},"subtoken")," is automatically generated for the module and managed by the ",(0,a.kt)("inlineCode",{parentName:"p"},"ManagedConnection")," instance passed to the module.  This allows the module to have a subtoken with the request permissions.  It also ensures that the token is for the current user if the user decides to log into a different account."),(0,a.kt)("h2",{id:"caching"},"Caching"),(0,a.kt)("p",null,"API responses are ",(0,a.kt)("em",{parentName:"p"},(0,a.kt)("a",{parentName:"em",href:"https://github.com/blish-hud/Blish-HUD/issues/445"},"currently"))," cached in memory based on the headers returned in the response from the API.  These responses are cached between modules to help ensure that overlapping requests can be served quickly where possible."),(0,a.kt)("p",null,"It is best practice to not rely on Blish HUD's caching mechanisms for data that is static and persistent, however.  Avoid repetitive requests to the API and instead keep the processed results of your request to keep your user experience the best it can be."),(0,a.kt)("h2",{id:"rate-limits"},"Rate Limits"),(0,a.kt)("p",null,"Guild Wars 2's web API has a strict limit of 300 messages per minute (despite what the API headers indicating 600 may have you to believe).  Blish HUD uses a custom token bucket middleware we've written that will artificially delay your requests to the API if our calculations indicate that the request would normally be rate limited."),(0,a.kt)("p",null,"All modules share this same rate limit.  In fact, all software on the same network will share this same rate limit.  For that reason, be mindful of what API requests to make and when to help avoid locking other modules or software from making API requests for extended periods of time."),(0,a.kt)("h2",{id:"error-handling"},"Error Handling"),(0,a.kt)("p",null,"The Guild Wars 2 API has on more than one occasion experienced periods of both partial and full downtime with responses ranging.  For that reason, it is critically important that you wrap requests to the Guild Wars 2 API to ensure exceptions are caught and properly handled."),(0,a.kt)("p",null,"Consider implementing a retry mechanism that tries a few minutes later.  If the information is critical for the functionality of your module, it is best to notify the user so that they understand why the module is not functioning as expected."),(0,a.kt)("p",null,"See our guide on ",(0,a.kt)("a",{parentName:"p",href:"/docs/modules/module-citizen/ensuring-stability#handle-exceptions-when-working-with-external-resources"},"handling exceptions"),"."),(0,a.kt)("h2",{id:"making-requests"},"Making Requests"),(0,a.kt)("p",null,"Standard API requests are made through the V2 client found under the ",(0,a.kt)("inlineCode",{parentName:"p"},"Gw2ApiManager"),".  Your module will have an instance of this passed to it via the ModuleParameters and assigned to Gw2ApiManager."),(0,a.kt)("p",null,"You can access this via:\n",(0,a.kt)("inlineCode",{parentName:"p"},"Gw2ApiManager.Gw2ApiClient.V2")),(0,a.kt)("p",null,"The provided client will already have a token associated with it and you can begin making requests without any configuration."),(0,a.kt)("p",null,"You can read the ",(0,a.kt)("a",{parentName:"p",href:"https://github.archomeda.eu/Gw2Sharp/master/guides/introduction.html#web-api-v2"},"Gw2Sharp V2 API guide here"),"."),(0,a.kt)("h2",{id:"checking-for-permissions"},"Checking for Permissions"),(0,a.kt)("p",null,"While your module may request certain permissions, the token assigned to your module may not have those permissions."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The subtoken might still be getting generated and not have been assigned to the module yet."),(0,a.kt)("li",{parentName:"ul"},"The user may not have an API token added to Blish HUD."),(0,a.kt)("li",{parentName:"ul"},"The user may have not consented to the permissions requested by your module when enabling your module.")),(0,a.kt)("p",null,"For these reasons, it's always best to check every time before making an API request that you have the expected permissions."),(0,a.kt)("h3",{id:"check-with-haspermissions"},"Check with ",(0,a.kt)("inlineCode",{parentName:"h3"},"HasPermissions")),(0,a.kt)("p",null,"Before every request, check that the appropriate permissions are available with ",(0,a.kt)("inlineCode",{parentName:"p"},"Gw2ApiManager.HasPermissions"),".  In the example below, we check for the permissions needed to see the account achievements prior to making the actual API call."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cpp",metastring:"{3}","{3}":!0},'try {\n    // v2/account/achievements requires "account" and "progression" permissions.\n    if (Gw2ApiManager.HasPermissions(new[] { TokenPermission.Account, TokenPermission.Progression })) {\n        Logger.Debug("Getting user achievements from the API.");\n\n        var achievements = await Gw2ApiManager.Gw2ApiClient.V2.Account.Achievements.GetAsync();\n\n        HandleAchievements(achievements);\n\n        Logger.Debug("Loaded {achievementCount} player achievements from the API.", achievements.Count);\n    } else {\n        Logger.Debug("Skipping user achievements from the API - API key does not give us permission.");\n    }\n} catch (Exception ex) {\n    Logger.Warn(ex, "Failed to load account achievements.");\n}\n')),(0,a.kt)("h3",{id:"check-again-with-subtokenupdated"},"Check again with ",(0,a.kt)("inlineCode",{parentName:"h3"},"SubtokenUpdated")),(0,a.kt)("p",null,"The subtoken may be populated after your module has already started or later if the user changes API keys in Blish HUD, etc.  For this reason, if you are not already checking the API on a regular interval, it is best to trigger your requests again with the ",(0,a.kt)("inlineCode",{parentName:"p"},"SubtokenUpdated")," event.  This event is fired when your module is given a new API token to use."))}c.isMDXComponent=!0}}]);